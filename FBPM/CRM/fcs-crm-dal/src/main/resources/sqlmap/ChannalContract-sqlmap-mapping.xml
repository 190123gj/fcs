<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>specialmer-dalgen</tt>, a DAL (Data Access Layer)  -->
<!-- code generation utility specially developed for <tt>rent</tt> project.     -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>specialmer-dalgen</tt> to generate this file.                                -->
<!--                                                                               -->
<!-- @author peigen                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="specialmer">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->
     <resultMap id="RM-FORM_CONTRACT" class="com.born.fcs.crm.dal.dataobject.FormDO">
        <result property="formId" column="form_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="formCode" column="form_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="formName" column="form_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="formUrl" column="form_url" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="actInstId" column="act_inst_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="actDefId" column="act_def_id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="defId" column="def_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="runId" column="run_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="taskId" column="task_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="status" column="status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="detailStatus" column="detail_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userId" column="user_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="userAccount" column="user_account" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userName" column="user_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userMobile" column="user_mobile" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userEmail" column="user_email" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptId" column="dept_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="deptCode" column="dept_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptName" column="dept_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptPath" column="dept_path" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptPathName" column="dept_path_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="checkStatus" column="check_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="submitTime" column="submit_time" javaType="java.util.Date" jdbcType="DATETIME"/>
        <result property="finishTime" column="finish_time" javaType="java.util.Date" jdbcType="DATETIME"/>
        <result property="relatedProjectCode" column="related_project_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="taskUserData" column="task_user_data" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="trace" column="trace" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="remark" column="remark" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="rawAddTime" column="raw_add_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="rawUpdateTime" column="raw_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
    </resultMap>
    <!-- result maps for database table channal_contract -->
    <resultMap id="RM-CHANNAL-CONTRACT" class="com.born.fcs.crm.dal.dataobject.ChannalContractDO" extends="RM-FORM_CONTRACT">
        <result property="formId" column="form_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="contract" column="contract" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="contractReturn" column="contract_return" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="contractNo" column="contract_no" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="channalCode" column="channal_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="channalName" column="channal_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="channalType" column="channal_type" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="rawAddTime" column="raw_add_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="rawUpdateTime" column="raw_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="info1" column="info1" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="info2" column="info2" javaType="java.lang.String" jdbcType="VARCHAR"/>
       
    </resultMap>


    
    <!-- ============================================= -->
    <!-- mapped statements for IbatisChannalContractDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisChannalContractDAO.insert -->
    <insert id="MS-CHANNAL-CONTRACT-INSERT">
    <![CDATA[
    	insert into channal_contract(form_id,contract,contract_return,contract_no,channal_code,channal_name,channal_type,info1,info2,raw_add_time) VALUES (#formId#,#contract#,#contractReturn#,#contractNo#,#channalCode#,#channalName#,#channalType#,#info1#,#info2#,#rawAddTime#)
    
    ]]>
    </insert>
    <update id="MS-CHANNAL-CONTRACT-UPDATE">
    <![CDATA[
		update channal_contract SET contract=#contract#,contract_return=#contractReturn#,contract_no=#contractNo#,channal_code=#channalCode#,channal_name=#channalName#,channal_type=#channalType#,info1=#info1#,info2=#info2# WHERE form_id=#formId#
    ]]>
    </update>
    
    <update id="MS-CHANNAL-CONTRACT-STATUS-UPDATE">
    <![CDATA[
   	 update form SET status=#status# WHERE form_id=#formId# 
    ]]>
    </update>
    
	 <select id="MS-CHANNAL-MAX-CONTRACT-NO" resultClass="java.lang.String">
    <![CDATA[
    	SELECT MAX(contract_no) FROM channal_contract  c LEFT JOIN form f ON c.form_id=f.form_id WHERE f.status !="DELETED" and channal_code=#value#
    ]]>
    </select>
    
    <select id="MS-CHANNAL-MAX-CHANNAL-CODE" resultClass="java.lang.String">
    <![CDATA[
    	SELECT MAX(channal_code) FROM channal_contract  c LEFT JOIN form f ON c.form_id=f.form_id WHERE f.status !="DELETED" and  c.channal_type=#value#
    ]]>
    </select>
    
    <!-- mapped statement for IbatisChannalContractDAO.findById -->
    <select id="MS-CHANNAL-CONTRACT-FIND-BY-ID" resultMap="RM-CHANNAL-CONTRACT">
    <![CDATA[
        select f.form_id ,f.form_code ,f.form_name ,f.form_url ,f.act_inst_id ,f.act_def_id ,f.def_id ,
			f.run_id ,f.task_id ,f.status ,f.detail_status ,f.user_id ,f.user_account ,f.user_name ,f.user_mobile ,f.user_email ,f.dept_id ,
			f.dept_code ,f.dept_name ,f.dept_path ,f.dept_path_name ,f.check_status ,f.submit_time ,f.finish_time ,f.related_project_code ,f.task_user_data ,
			f.trace ,f.remark  ,c.contract_return,c.info1,c.info2,c.raw_update_time, c.contract, c.contract_no, c.channal_code, c.channal_name, c.channal_type, c.raw_add_time, c.raw_update_time FROM channal_contract c LEFT JOIN form f ON c.form_id=f.form_id WHERE  (c.form_id = #value#)
    ]]>
    </select>
    
    <select id="MS-CHANNAL-CONTRACT-FIND-BY-NO" resultMap="RM-CHANNAL-CONTRACT">
    <![CDATA[
        select f.form_id ,f.form_code ,f.form_name ,f.form_url ,f.act_inst_id ,f.act_def_id ,f.def_id ,
			f.run_id ,f.task_id ,f.status ,f.detail_status ,f.user_id ,f.user_account ,f.user_name ,f.user_mobile ,f.user_email ,f.dept_id ,
			f.dept_code ,f.dept_name ,f.dept_path ,f.dept_path_name ,f.check_status ,f.submit_time ,f.finish_time ,f.related_project_code ,f.task_user_data ,
			f.trace ,f.remark  ,c.contract_return,c.info1,c.info2,c.raw_update_time, c.contract, c.contract_no, c.channal_code, c.channal_name, c.channal_type, c.raw_add_time, c.raw_update_time FROM channal_contract c LEFT JOIN form f ON c.form_id=f.form_id WHERE f.status !="DELETED" and c.contract_no=#contractNo#
    ]]>
    </select>

    <!-- mapped statement for IbatisChannalContractDAO.deleteById -->
    <delete id="MS-CHANNAL-CONTRACT-DELETE-BY-ID">
    <![CDATA[
        delete /*MS-YRD-CHANNAL-CONTRACT-DELETE-BY-ID*/ from channal_contract where (form_id = #value#)
    ]]>
    </delete>
    
    <!-- mapped statement for IbatisChannalContractDAO.findWithCondition -->
    <select id="MS-CHANNAL-CONTRACT-FIND-WITH-CONDITION" resultMap="RM-CHANNAL-CONTRACT">
		select f.form_id ,f.form_code ,f.form_name ,f.form_url ,f.act_inst_id ,f.act_def_id ,f.def_id ,
			f.run_id ,f.task_id ,f.status ,f.detail_status ,f.user_id ,f.user_account ,f.user_name ,f.user_mobile ,f.user_email ,f.dept_id ,
			f.dept_code ,f.dept_name ,f.dept_path ,f.dept_path_name ,f.check_status ,f.submit_time ,f.finish_time ,f.related_project_code ,f.task_user_data ,
			f.trace ,f.remark  , c.contract_return,c.info1,c.info2,c.raw_update_time,c.contract, c.contract_no, c.channal_code, c.channal_name, c.channal_type, c.raw_add_time, c.raw_update_time FROM channal_contract c LEFT JOIN form f ON c.form_id=f.form_id        
			LEFT JOIN channal_info ci ON c.channal_code=ci.channel_code and ci.is_history = 'NO'
			<include refid="formPermissionSql"/>
			where  (f.status !="DELETED")
			<dynamic prepend="and">					
					<isNotEmpty property="channalContract.channalName" prepend=" and ">
                       c.channal_name = #channalContract.channalName#
                   	</isNotEmpty>
                   	<isNotEmpty property="channalContract.channalType" prepend=" and ">
                        c.channal_type = #channalContract.channalType#
                   	</isNotEmpty>       
                   	<isNotEmpty property="channalContract.channalCode" prepend=" and ">	
                        c.channal_code = #channalContract.channalCode#
                   	</isNotEmpty> 
                   	<isNotEmpty property="likeChannalName" prepend=" and ">
                         c.channal_name like concat('%',#likeChannalName#,'%')
                   	</isNotEmpty> 
                   <isGreaterThan property="likeChannalCode" prepend=" and " compareValue="0">
                         c.channal_code like concat('%',#likeChannalCode#,'%')
                   	</isGreaterThan>    	
                   	<isNotEmpty property="startDate" prepend=" and ">
                        c.raw_update_time > #startDate#
                   	</isNotEmpty> 
                   	<isNotEmpty property="endDate" prepend=" and ">
                      #endDate# >  c.raw_update_time 
                   	</isNotEmpty>
                   <isNotEmpty property="channalContract.status" prepend=" and ">
                      f.status = #channalContract.status# 
                   	</isNotEmpty>
                   	<isEqual property="channalContract.info1" prepend=" and " compareValue="IS">
                      ci.channel_code IS NULL   
                   	</isEqual>
                   	
                   	     
				</dynamic>	
				order by c.raw_update_time DESC
			    LIMIT #limitStart#,#pageSize#;
    </select>

    <!-- mapped statement for IbatisChannalContractDAO.countWithCondition -->
    <select id="MS-CHANNAL-CONTRACT-COUNT-WITH-CONDITION" resultClass="long">
        SELECT   count(*) FROM  channal_contract c LEFT JOIN form f ON c.form_id=f.form_id        
			LEFT JOIN channal_info ci ON c.channal_code=ci.channel_code	 and ci.is_history = 'NO'
			<include refid="formPermissionSql"/>
			where  (f.status !="DELETED")
			<dynamic prepend="and">					
					<isNotEmpty property="channalContract.channalName" prepend=" and ">
                       c.channal_name = #channalContract.channalName#
                   	</isNotEmpty>
                   	<isNotEmpty property="channalContract.channalType" prepend=" and ">
                        c.channal_type = #channalContract.channalType#
                   	</isNotEmpty>       
                   	<isNotEmpty property="channalContract.channalCode" prepend=" and ">	
                        c.channal_code = #channalContract.channalCode#
                   	</isNotEmpty> 
                   	<isNotEmpty property="likeChannalName" prepend=" and ">
                         c.channal_name like concat('%',#likeChannalName#,'%')
                   	</isNotEmpty> 
                   <isGreaterThan property="likeChannalCode" prepend=" and " compareValue="0">
                         c.channal_code like concat('%',#likeChannalCode#,'%')
                   	</isGreaterThan>     	
                   	<isNotEmpty property="startDate" prepend=" and ">
                        c.raw_update_time > #startDate#
                   	</isNotEmpty> 
                   	<isNotEmpty property="endDate" prepend=" and ">
                      #endDate# >  c.raw_update_time 
                   	</isNotEmpty>
                   <isNotEmpty property="channalContract.status" prepend=" and ">
                      f.status = #channalContract.status# 
                   	</isNotEmpty> 
                   	<isEqual property="channalContract.info1" prepend=" and " compareValue="IS">
                      ci.channel_code IS NULL   
                   	</isEqual>
                 </dynamic>
    </select>

</sqlMap>
