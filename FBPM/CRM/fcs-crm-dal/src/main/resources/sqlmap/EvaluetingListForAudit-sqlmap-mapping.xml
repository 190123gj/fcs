<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>specialmer-dalgen</tt>, a DAL (Data Access Layer)  -->
<!-- code generation utility specially developed for <tt>rent</tt> project.     -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>specialmer-dalgen</tt> to generate this file.                                -->
<!--                                                                               -->
<!-- @author peigen                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="specialmer">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->
     <resultMap id="RM-FORM_EVALUE" class="com.born.fcs.crm.dal.dataobject.FormDO">
        <result property="formId" column="form_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="formCode" column="form_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="formName" column="form_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="formUrl" column="form_url" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="actInstId" column="act_inst_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="actDefId" column="act_def_id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="defId" column="def_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="runId" column="run_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="taskId" column="task_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="status" column="status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="detailStatus" column="detail_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userId" column="user_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="userAccount" column="user_account" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userName" column="user_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userMobile" column="user_mobile" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="userEmail" column="user_email" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptId" column="dept_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="deptCode" column="dept_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptName" column="dept_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptPath" column="dept_path" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="deptPathName" column="dept_path_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="checkStatus" column="check_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="submitTime" column="submit_time" javaType="java.util.Date" jdbcType="DATETIME"/>
        <result property="finishTime" column="finish_time" javaType="java.util.Date" jdbcType="DATETIME"/>
        <result property="relatedProjectCode" column="related_project_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="taskUserData" column="task_user_data" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="trace" column="trace" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="remark" column="remark" javaType="java.lang.String" jdbcType="TEXT"/>
        <result property="rawAddTime" column="raw_add_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="rawUpdateTime" column="raw_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
    </resultMap>
    
    <!-- result maps for database table evalueting_list -->
    <resultMap id="RM-EVALUETING-LIST_EVALUE" class="com.born.fcs.crm.dal.dataobject.EvaluetingListForAuditDO" extends="RM-FORM_EVALUE">
        <result property="formId" column="form_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="projectCode" column="project_code" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="customerId" column="customer_id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="customerName" column="customer_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="busiLicenseNo" column="busi_license_no" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="level" column="level" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="year" column="year" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditTime" column="audit_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="operator" column="operator" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditStatus" column="audit_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="evaluetingType" column="evalueting_type" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="isProsecute" column="is_prosecute" javaType="java.lang.String" jdbcType="ENUM"/>
        <result property="evaluetingInstitutions" column="evalueting_institutions" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="evaluetingTime" column="evalueting_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="auditImg" column="audit_img" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion1" column="audit_opinion1" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion2" column="audit_opinion2" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion3" column="audit_opinion3" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion4" column="audit_opinion4" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion5" column="audit_opinion5" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="auditOpinion6" column="audit_opinion6" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="editStatus" column="edit_status" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="rawAddTime" column="raw_add_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="rawUpdateTime" column="raw_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
    </resultMap>
    
        <!-- 表单权限通用sql -->
    <sql id="formPermissionSql">
	    <isNotEmpty property="deptIdList">
            JOIN (SELECT COUNT(*) rnum,form_id FROM form_related_user
            	   WHERE dept_id in 
            	   		<iterate property="deptIdList" open="(" close=")" conjunction=",">
							#deptIdList[]#
						</iterate>
						<isGreaterThan property="loginUserId"  compareValue="0" prepend=" OR ">
							user_id = #loginUserId#
						</isGreaterThan>
				   GROUP BY form_id) rl
   			  ON rl.form_id = f.form_id AND rl.rnum > 0
	    </isNotEmpty>     
    	<isEmpty property="deptIdList">
 		  <isGreaterThan property="loginUserId"  compareValue="0">
	            JOIN (SELECT COUNT(*) rnum,form_id FROM form_related_user 
	            	   WHERE user_id = #loginUserId# GROUP BY form_id) rl
    			  ON rl.form_id = f.form_id AND rl.rnum > 0
	      </isGreaterThan>
	    </isEmpty>    	
    </sql>  
   

    <!-- mapped statement for IbatisEvaluetingListDAO.findById -->
    <select id="evalueting_form_info_byId" resultMap="RM-EVALUETING-LIST_EVALUE">
    <![CDATA[
         SELECT  f.form_id ,f.form_code ,f.form_name ,f.form_url ,f.act_inst_id ,f.act_def_id ,f.def_id ,
			f.run_id ,f.task_id ,f.status ,f.detail_status ,f.user_id ,f.user_account ,f.user_name ,f.user_mobile ,f.user_email ,f.dept_id ,
			f.dept_code ,f.dept_name ,f.dept_path ,f.dept_path_name ,f.check_status ,f.submit_time ,f.finish_time ,f.related_project_code ,f.task_user_data ,
			f.trace ,f.remark  ,e.customer_id ,e.customer_name ,e.busi_license_no ,e.level ,e.year ,e.audit_time ,e.operator ,e.audit_status ,e.evalueting_type ,
			e.is_prosecute ,e.project_code,e.evalueting_institutions ,e.evalueting_time ,e.audit_img ,e.audit_opinion1 ,e.audit_opinion2 ,e.audit_opinion3 ,e.audit_opinion4 ,
			e.audit_opinion5 ,e.edit_status,e.audit_opinion6 ,e.raw_add_time ,e.raw_update_time  FROM evalueting_list e LEFT JOIN form f ON e.form_id=f.form_id WHERE  (e.form_id = #value#)
    ]]>
    </select>


    <!-- mapped statement for IbatisEvaluetingListDAO.findWithCondition -->
    <select id="evalueting_form_info" resultMap="RM-EVALUETING-LIST_EVALUE">
	    SELECT  f.form_id ,f.form_code ,f.form_name ,f.form_url ,f.act_inst_id ,f.act_def_id ,f.def_id ,
			f.run_id ,f.task_id ,f.status ,f.detail_status ,f.user_id ,f.user_account ,f.user_name ,f.user_mobile ,f.user_email ,f.dept_id ,
			f.dept_code ,f.dept_name ,f.dept_path ,f.dept_path_name ,f.check_status ,f.submit_time ,f.finish_time ,f.related_project_code ,f.task_user_data ,
			f.trace ,f.remark ,e.customer_id ,e.customer_name ,e.busi_license_no ,e.level ,e.year ,e.audit_time ,e.operator ,e.audit_status ,e.evalueting_type ,
			e.is_prosecute ,e.edit_status,e.project_code,e.evalueting_institutions ,e.evalueting_time ,e.audit_img ,e.audit_opinion1 ,e.audit_opinion2 ,e.audit_opinion3 ,e.audit_opinion4 ,
			e.audit_opinion5 ,e.audit_opinion6 ,e.raw_add_time ,e.raw_update_time  FROM evalueting_list e LEFT JOIN form f ON e.form_id=f.form_id 
			<include refid="formPermissionSql"/>
			where  (f.status !="DELETED")
				<dynamic prepend="and">
					<isNotEmpty property="evaluetingList.customerId" prepend=" and " >
	                     e.customer_id = #evaluetingList.customerId#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.customerName" prepend=" and " >
	                     e.customer_name = #evaluetingList.customerName#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.busiLicenseNo" prepend=" and " >
	                    e.busi_license_no = #evaluetingList.busiLicenseNo#
                  	</isNotEmpty>  
                  	
                  	<isNotEmpty property="likeCustomerName" prepend=" and " >
	                     e.customer_name like concat('%',#likeCustomerName#,'%')
                  	</isNotEmpty>
                  	<isNotEmpty property="likeBusiLicenseNo" prepend=" and " >
	                    e.busi_license_no like concat('%', #likeBusiLicenseNo#,'%')
                  	</isNotEmpty>
                  	          	
                  	 <isNotEmpty property="evaluetingList.auditTime" prepend=" and ">
                      e.audit_time = #evaluetingList.auditTime#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.evaluetingType" prepend=" and ">
                      e.evalueting_type = #evaluetingList.evaluetingType#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.isProsecute" prepend=" and ">
                      e.is_prosecute = #evaluetingList.isProsecute#
                  	</isNotEmpty>
                  	 <isNotEmpty property="evaluetingList.level" prepend=" and ">
                      e.level = #evaluetingList.level#
                  	</isNotEmpty>
                  	 <isNotEmpty property="evaluetingList.year" prepend=" and ">
                      e.year = #evaluetingList.year#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.operator" prepend=" and ">
                      e.operator = #evaluetingList.operator#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.status" prepend=" and ">
                      f.status = #evaluetingList.status#
                  	</isNotEmpty>                       	
				</dynamic>
				order by e.raw_update_time DESC  LIMIT #limitStart#,#pageSize#;
    	</select>

    <!-- mapped statement for IbatisEvaluetingListDAO.countWithCondition -->
    <select id="evalueting_form_count" resultClass="long">
       	 SELECT  count(*) FROM evalueting_list e LEFT JOIN form f on e.form_id=f.form_id
       	 <include refid="formPermissionSql"/>
       	 where  (f.status !="DELETED")		
				<dynamic prepend=" and ">
					<isNotEmpty property="evaluetingList.customerId" prepend=" and " >
	                     e.customer_id = #evaluetingList.customerId#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.customerName" prepend=" and " >
	                     e.customer_name = #evaluetingList.customerName#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.busiLicenseNo" prepend=" and " >
	                    e.busi_license_no = #evaluetingList.busiLicenseNo#
                  	</isNotEmpty> 
                  	<isNotEmpty property="likeCustomerName" prepend=" and " >
	                     e.customer_name like concat('%',#likeCustomerName#,'%')
                  	</isNotEmpty>
                  	<isNotEmpty property="likeBusiLicenseNo" prepend=" and " >
	                    e.busi_license_no like concat('%', #likeBusiLicenseNo#,'%')
                  	</isNotEmpty>
             	
                  	 <isNotEmpty property="evaluetingList.auditTime" prepend=" and ">
                      e.audit_time = #evaluetingList.auditTime#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.evaluetingType" prepend=" and ">
                      e.evalueting_type = #evaluetingList.evaluetingType#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.isProsecute" prepend=" and ">
                      e.is_prosecute = #evaluetingList.isProsecute#
                  	</isNotEmpty>
                  	 <isNotEmpty property="evaluetingList.level" prepend=" and ">
                      e.level = #evaluetingList.level#
                  	</isNotEmpty>
                  	 <isNotEmpty property="evaluetingList.year" prepend=" and ">
                      e.year = #evaluetingList.year#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.operator" prepend=" and ">
                      e.operator = #evaluetingList.operator#
                  	</isNotEmpty>
                  	<isNotEmpty property="evaluetingList.status" prepend=" and ">
                      f.status = #evaluetingList.status#
                  	</isNotEmpty>                       	
				</dynamic>
    </select>

</sqlMap>
